#
# Inovance SV660N
-
  vendor_id:  0x00100000
  product_code:  0x000C010D
  revision_no:  0x00010000

  addresses:
    - [0, 0]
    - [0, 1]
    - [0, 2]
    - [0, 3]
    - [0, 4]
    - [0, 5]

  # Distributed clock
  dc_conf:
    sync0Shift: 350000

  # Sync manager configuration
  sync_manager:
    '0':
      # Mailboxes out
      dir: out
    '1':
      # Mailboxes in
      dir: in
    '2':
      # RPDOs:  Receive PDOs ("out" to drive)
      dir: out
      pdo_mapping:
        index: 1600h
        entries:
          - index: 6040h
            name: control_word
          # Convert joint cmd reference values to drive values
          # All joints:
          # - encoder resolution: 2**23 (23bit)
          # - belt ratio = 1 / 1 (unless otherwise specified)
          # - pos/vel cmd scale = (encoder resolution) * (gearbox ratio)
          #   * (belt ratio) / (2pi)
          # - torque cmd scale = 1000.0 / ((gearbox ratio) * (nominal torque))
          #
          # Joint 1:
          # - gearbox ratio: 101 (actually 100, but inverted!)
          # - belt ratio:  36 / 24
          # - nominal torque: 2.39 Nm
          # - pos/vel cmd scale:  202265896.97232303
          # - torque cmd scale:  2.7617824543960667
          #
          # Joint 2:
          # - gearbox ratio: 100
          # - nominal torque: 2.39 Nm
          # - pos/vel cmd scale:  133508842.88602179
          # - torque cmd scale:  4.1841004184100417
          #
          # Joint 3:
          # - gearbox ratio: 80
          # - nominal torque: 1.27 Nm
          # - pos/vel cmd scale:  106807074.30881745
          # - torque cmd scale:  9.8425196850393704
          #
          # Joint 4:
          # - gearbox ratio: 81 (actually 80, but inverted!)
          # - belt ratio:  36 / 28
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  139039923.51987126
          # - torque cmd scale:  30.006858710562415
          #
          # Joint 5:
          # - gearbox ratio: 81
          # - belt ratio:  30 / 30
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  108142162.73767766
          # - torque cmd scale:  38.580246913580247
          #
          # Joint 6:
          # - gearbox ratio: -50  (reverse direction)
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  -66754421.443010896
          # - torque cmd scale:  -62.5

          - index: 607Ah
            name: position_reference
            scale:
              - 202265896.97232303
              - 133508842.88602179
              - 106807074.30881745
              - 139039923.51987126
              - 108142162.73767766
              - -66754421.443010896
          - index: 60B1h
            name: velocity_reference
            scale:
              - 202265896.97232303
              - 133508842.88602179
              - 106807074.30881745
              - 139039923.51987126
              - 108142162.73767766
              - -66754421.443010896
          - index: 60B2h
            name: torque_reference
            scale:
              - 2.7617824543960667
              - 4.1841004184100417
              - 9.8425196850393704
              - 30.006858710562415
              - 38.580246913580247
              - -62.5
          - index: 6060h
            name: control_mode
          - index: 60FE-01h
            # forced EtherCAT DO outputs; bits 16-18 -> DO1-DO3
            bits:
              - bitLen:  16  # Bits 0-15 unused
              # Bits 16-18: DO1-DO3
              - dout1
              - dout2
              - dout3  # DO3 = brake
              - bitLen: 13  # Bits 19-31 unused
    '3':
      # TPDOs:  Transmit PDOs ("in" from drive)
      dir: in
      pdo_mapping:
        index: 1A00h
        entries:
          - index: 6041h
            name: status_word
          - index: 6061h
            name:  control_mode_fb
          # Convert joint drive feedback values to ROS (inverse direction)
          # - pos/vel fb scale = 1.0 / (pos/vel cmd scale)
          # - torque fb scale = 1. / (torque cmd scale)
          #
          # Joint 1:
          # - pos/vel fb scale:  4.9439871721768036e-09
          # - torque fb scale:  0.36208500000000005
          #
          # Joint 2:
          # - pos/vel fb scale:  7.4901405658478579e-09
          # - torque fb scale:  0.23899999999999999
          #
          # Joint 3:
          # - pos/vel fb scale:  9.3626757073098216e-09
          # - torque fb scale:  0.1016
          #
          # Joint 4:
          # - pos/vel fb scale:  7.1921788698127573e-09
          # - torque fb scale:  0.033325714285714285
          #
          # Joint 5:
          # - pos/vel fb scale:  9.2470871183306876e-09
          # - torque fb scale:  0.025920000000000002
          #
          # Joint 6:
          # - pos/vel fb scale:  -1.4980281131695716e-08
          # - torque fb scale:  -0.016

          - index: 6064h
            name:  position_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 606Ch
            name:  velocity_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 6077h
            name:  torque_actual_value
            scale:
              - 0.36208500000000005
              - 0.23899999999999999
              - 0.1016
              - 0.033325714285714285
              - 0.025920000000000002
              - -0.016
          - index: 60F4h
            name:  following_error_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 60FDh
            # forced EtherCAT DI inputs
            bits:
              - bitLen:  16  # 0-1 overtravel 2 home active; 3 to 15 N/A
              # Bits 16-20: DI1-DI5
              - din1
              - din2
              - din3
              - din4
              - din5
              - bitLen:  6  # 21 to 26 N/A
              - sto1
              - sto2
              - sto  # STO function triggered, active low
              - bitLen:  2  # 30 to 31 N/A
          - index: 203Fh
            name: error_code

  # Parameter settings
  param_values:
    # *** 2000h Servo Motor Parameters ***
    # Motor code:
    # 14101:  Inovance 23-bit absolute encoder
    2000-01h: 14101
    #
    # Subidxs 03, 05, 06 read-only

    # *** 2001h Servo Drive Parameters ***
    # Servo drive SN:
    # 2:  S1R6 0.2kW
    # 3:  S2R8 0.4kW
    # 5:  S5R5 0.75kW
    2001-0Bh: [5, 5, 3, 2, 2, 2]
    #
    # Subidxs 02, 03 MCU/FPGA firmware version, read-only

    # *** 2002h Basic control ***
    #
    # Absolute encoder system selection:  def. 0
    # 1:  Absolute position linear mode (encoder retains value on power down)
    2002-02h: 1
    #
    # Direction of rotation
    # 0 to 1;  def. 0
    # 0:  CCW;  1:  CW (viewed from motor shaft)
    2002-03h:  [0, 1, 1, 0, 0, 0]
    #
    # Stop mode at S-ON OFF
    # -3 to 1;  def. 0
    # 0:  Coast to stop, keeping de-energized status
    2002-06h:  0
    #
    # Stop mode at No. 2 fault
    # -5 to 3; def. 2
    # 2:  Ramp to stop as defined by 6085h, keeping de-energized status
    2002-07h:  2
    #
    # Stop mode at overtravel
    # 0 to 7;  def. 1
    # 1:  Stop at zero speed, keeping position lock status
    2002-08h:  1
    #
    # Stop mode at No. 1 fault
    # 0 to 2; def. 2
    # 2:  Dynamic braking stop, keeping dynamic braking status
    2002-09h:  2
    #
    # Delay from brake output ON to command received:  def. 250 (0-500 ms)
    # - Drive will not respond to pos/vel/tor cmd within this time from brake on
    2002-0Ah:  250
    #
    # Delay from brake output off to motor de-energized in the
    #   standstill state:  def. 150 (50-1000ms)
    # - Upon brake off, after this time, motor will turn off
    2002-0Bh:  150
    #
    # Motor speed threshold at brake output OFF in the rotation state
    # 20 to 3000 RPM; def. 30
    2002-0Ch:  30
    # Delay from S-OFF to brake output OFF in the rotational state:
    #   def. 500 (1-1000ms)
    # - Time from motor disabled to brake signal off
    2002-0Dh:  500
    #
    # Warning display on the keypad
    # 0 to 1; def. 0
    2002-10h:  0
    #
    # Resistor heat dissipation coefficient
    # 10 to 100 %; def. 30
    2002-19h: 30
    #
    # Regenerative resistor setting
    # 0 to 3; def. 0
    # 0:  Internal braking resistor
    # 1:  External, natural ventilation
    # 2:  External, forced air cooling
    # 3:  No regenerative resistor needed
    2002-1Ah: [0, 0, 3, 3, 3, 3]
    #
    # Power of external regenerative resistor
    # 1 to 65535 Watts; def. 40
    # 2002-1Bh:  40
    #
    # Resistance of external regenerative resistor
    # 15 to 1000 Ohms; def. 50
    # 2002-1Ch:  50
    #
    # System parameter initialization
    # 0 to 2; def. 0
    # 0:  No operation
    # 1:  Restore default setting
    # 2:  Clear fault records
    # 2002-20h:  0  # This command param; not setting
    #
    # Default keypad display
    # 0 to 99; def. 50
    2002-21h: 50
    #
    # Keypad data refresh frequency
    # 0 to 20; def. 0
    2002-24h: 0
    #
    # Subidxs 01, 16-18 read-only

    # *** 2003h Terminal input parameters ***
    #
    # Values for DI "function selection" parameters:
    # 0: No definition
    # 1: S-ON
    # 2: Fault reset
    # 14: Positive limit switch
    # 15: Negative limit switch
    # 31: Home switch
    # 34: Emergency stop
    # 38: Touch probe 1
    # 39: Touch probe 2
    #
    # DI1-DI5 function selection
    2003-03h:  0
    2003-05h:  0
    2003-07h:  0
    # DI4, DI5 unused
    # 2003-09h:  0
    # 2003-0Bh:  0
    #
    # DI1-DI5 logic
    # 0 to 1; def. 0
    # 0:  Low level active
    # 1:  High level active
    2003-04h:  0
    2003-06h:  0
    2003-08h:  0
    2003-0Ah:  0
    2003-0Ch:  0
    #
    # DI1-DI5 filter time
    # 0 to 50000 ms; def. 50
    2003-3Dh:  50
    2003-3Eh:  50
    2003-3Fh:  50
    2003-40h:  50
    2003-41h:  50

    # *** 2004h Terminal Output Parameters ***
    #
    # NOTE:  These work in concert with 60FE-01h (PDO), 60FE-02h, 200D-12h, 200D-14h
    #
    # Values for DO "function selection" parameters:
    # 0: No definition
    # 1: Servo ready
    # 2: Motor rotating
    # 9: Brake output
    # 10: Warning
    # 11: Fault
    # 25: Comparison output
    # 32: STO EDM
    # Values for DO "logic selection" parameters:
    # 0: Normally open
    # 1: Normally closed
    #
    # - DO1, DO2:  EtherCAT forced output
    2004-01h: 0x001F
    2004-03h: 0x001F
    # - DO3:  Brake output
    2004-05h: 0x0009
    #
    # DO1-DO3 logic selection
    # - 0:  Enabled on DO low
    # - 1:  Enabled on DO high
    2004-02h: 1
    2004-04h: 1
    # - Brake logic is inverted
    2004-06h: 0
    #
    # EtherCAT forced DO output logic in non-OP status
    # 0 to 7; def. 1
    # 0:  Status of DO1 to DO3 unchanged in the non-OP status
    # 1:  No output in DO1 and status of others unchanged in the non-OP status
    # 7:  No output in DO1, DO2, or DO3
    2004-18h: 7

    # *** 2005h Position Control Parameters ***
    #
    # First-order low-pass filter time constant
    # 0 to 65535 ms/10; def. 0
    2005-05h:  0
    #
    # Moving average filter time constant 1
    # 0 to 10000 ms/10; def. 0
    2005-06h:  0
    #
    # Moving average filter time constant 2
    # 0 to 1280 ms/10; def. 0
    2005-07h:  0
    #
    # Numerator of electronic gear ratio
    # 0 to 4294967295; def. 1
    2005-08h:  1
    #
    # Denominator of electronic gear ratio
    # 0 to 4294967295; def. 1
    2005-0Ah:  1
    #
    # Speed feedforward control selection
    # - 0: No speed feedforward
    # - 1: Internal speed feedforward
    # - 2: 60B1h as speed feedforward
    # - 3: Zero phase control
    # - Use 60B1h as source of speed feedforward signal in CSP mode
    2005-14h: 2
    #
    # Local homing
    # 0, 6; def. 0
    2005-1Fh:  0
    #
    # Homing time limit
    # 0 to 65535 ms/10; def. 50000
    2005-24h:  50000
    #
    # Local home offset
    # -1073741824 to +1073741824 encoder units; def. 0
    2005-25h:  0
    #
    # Position offset in absolute position linear mode (low 32 bits)
    # -2^31 to +(2^31 - 1) encoder units; def. 0
    2005-2Fh:  0
    #
    # Position offset in absolute position linear mode (high 32 bits)
    # -2^31 to +(2^31 - 1) encoder units; def. 0
    2005-31h:  0
    # Mechanical gear ratio (numerator) in the absolute position
    #   rotation mode
    # 1 to 65535; def. 1
    2005-33h:  1
    #
    # Mechanical gear ratio (denominator) in absolute position
    #   rotation mode
    # 1 to 65535; def. 1
    2005-34h:  1
    #
    # Pulses per load revolution in the absolute position rotation
    #   mode (low 32 bits)
    # 0 to (2^32 - 1) encoder units; def. 0
    2005-35h:  0
    #
    # Pulses per load revolution in the absolute position rotation
    #   mode (high 32 bits)
    # 0 to 127 encoder units; def. 0
    2005-37h:  0

    # *** 2006h Speed Control Parameters ***
    #
    # Speed reference
    # -6000 to +6000 RPM; def. 200
    2006-04h:  200
    #
    # Acceleration ramp time constant of speed reference
    # 0 to 65535 ms; def. 0
    2006-06h:  0
    #
    # Deceleration ramp time of speed reference
    # 0 to 65535 ms; def. 0
    2006-07h:  0
    #
    # Forward speed limit
    # 0 to 6000 RPM; def. 6000
    2006-09h:  6000
    #
    # Reverse speed limit
    # 0 to 6000 RPM; def. 6000
    2006-0Ah:  6000
    #
    # Quick stop deceleration coefficient
    # 0 to 2; def. 0
    # 0:  x1
    # 1:  x10
    # 2:  x100
    2006-0Bh:  0
    #
    # Torque feedforward control selection
    # 2: Use 60B2h as source of torque feedforward signal in CSP mode
    2006-0Ch: 2
    #
    # Acceleration/Deceleration ramp time constant of jog speed
    #   reference
    # 0 to 65535 ms; def. 10
    2006-0Dh:  10
    #
    # Speed feedforward filter time constant
    # 1 to 2000 us; def. 0
    2006-0Eh:  0

    # *** 2007h Torque Control Parameters ***
    #
    # Torque reference value set through keypad
    # -4000 to +4000 %/10; def. 0
    2007-04h:   0
    #
    # Torque reference filter time constant 1:  0-3000 (x 0.01ms) def. 79
    2007-06h: 100
    #
    # Torque reference filter time constant 2:  0-3000 (x 0.01ms) def. 79
    2007-07h: 100
    #
    # Positive internal torque limit
    # 0 to 4000 %/10; def. 3500
    2007-0Ah:  3500
    #
    # Negative internal torque limit
    # 0 to 4000 %/10; def. 3500
    2007-0Bh:  3500
    #
    # Emergency stop torque
    # 0 to 4000 %/10; def. 1000
    2007-10h:  1000
    #
    # Positive internal speed limit in torque control
    # 0 to 6000 RPM; def. 3000
    2007-14h:  3000
    #
    # Negative internal torque limit in torque control
    # 0 to 6000 RPM; def. 3000
    2007-15h:  3000
    #
    # Base value for torque reached
    # 0 to 4000  %/10; def 0
    2007-16h:  0
    #
    # Threshold for valid torque reach
    # 0 to 4000 %/10; def. 200
    2007-17h:  200
    #
    # Threshold for invalid torque reach
    # 0 to 4000 %/10; def. 100
    2007-18h:  100
    #
    # Field-weakening depth
    # 60 to 115 *100%; def. 115
    2007-19h:  115
    # Max. permissible demagnetizing current
    # 1 to 100 *100%; def. 100
    2007-1Ah:  100
    #
    # Field-weakening selection
    # 0 to 1; def. 0
    # 0: Disable; 1: Enable
    2007-1Bh:  0
    #
    # Field-weakening gain
    # 1 to 1000; def. 30
    2007-1Ch:  30
    #
    # Time constant of low-pass filter 2
    # 0 to 1000 ms/100; def. 0
    2007-25h:  0
    #
    # Torque reference filter selection
    # 0 to 1; def. 0
    # 0: First-order filter; 1: Biquad filter
    2007-26h:  0
    #
    # Biquad filter attenuation ratio
    # 0 to 50; def. 16
    2007-27h:  16

    # *** 2008h Gain Parameters ***
    # NB: parameter values are all integers in drives but are decimals
    # in manual.  Example: speed loop gain of 800 is equal to 80.0 Hz
    # in the manual.
    #
    # Velocity proportional gain *0.1Hz
    2008-01h: [350, 400, 400, 250, 250, 400]
    #
    # Velocity time constant *0.01ms
    2008-02h: [1000, 1000, 1000, 1000, 1000, 1000]
    #
    # Position proportional gain *0.1Hz
    2008-03h: [550, 550, 550, 400, 400, 550]
    #
    # 2nd speed loop gain
    # 1 to 20000 Hz/10; def. 750
    2008-04h:  750
    #
    # 2nd speed loop integral time constant
    # 15 to 51200 ms/100; def. 1061
    2008-05h:  1061
    #
    # 2nd position loop gain
    # 1 to 20000 Hz/10; def. 1200
    2008-06h:  1200
    #
    # Gain switchover
    # use 2008-0Ah
    2008-09h: 1
    #
    # Gain switchover condition
    # 0-10; def. 0
    # 0:  Always use first gain
    # - No difference between gains in motion and gains when positioning
    2008-0Ah: 0
    #
    # Gain switchover delay
    # 0 to 10000 ms/10; def. 50
    2008-0Bh:  50
    #
    # Gain switchover level
    # 0 to 20000; def. 50
    2008-0Ch:   50
    #
    # Gain switchover dead time
    # 0 to 20000; def. 30
    2008-0Dh:  30
    #
    # Position gain switchover time
    # 0 to 10000 ms/10; def. 30
    2008-0Eh:  30
    #
    # Load moment of inertia ratio
    # 0 to 12000 %; def. 100
    # values from qc.py *0.01
    2008-10h: [45, 318, 216, 281, 141, 38]
    #
    # Zero phase delay
    # 0 to 40 ms/10; def. 0
    2008-12h:  0
    #
    # Velocity feedforward filter * 0.01ms
    2008-13h: 100
    #
    # Speed feedforward gain:  0-1000 (0.1%) def. 0
    # - Feedforward gain set to minimize following error - max value
    #   produces best results
    2008-14h: 1000
    #
    # Torque feedforward filter * 0.01ms
    2008-15h: 100
    #
    # Torque feedforward gain 0-2000 (0.1%) def. 0
    2008-16h: 1000
    #
    # Speed feedback filtering option
    # 0 to 4; def. 0
    2008-17h:   0
    #
    # Velocity feedback cutoff frequency
    2008-18h: 4000
    #
    # PID structure
    2008-19h: 1000

    # *** 2009h Gain Auto-Tuning Parameters ***
    #
    # Automatic gain tuning mode:  def. 4
    # 0: disabled
    # 1:  Automatic gain tuning mode, gain parameters tuned automatically
    #     based on stiffness table
    # 4:  Normal mode+Inertia auto-tuning
    2009-01h: 0
    #
    # Stiffness level selection 0-31;
    # higher -> stronger gain and quicker response
    # 2009-02h: 8
    2009-02h: [14, 15, 15, 12, 12, 15]
    #
    # Adaptive notch mode
    # 0 to 4; def. 3
    2009-03h:  0
    #
    # Disable inertia ratio autotune
    2009-04h: 0
    #
    # Offline inertia autotuning mode
    # 0 to 1; def. 1
    2009-06h:  0
    #
    # Maximum speed in inertia auto-tuning
    # 100 to 1000 RPM; def. 500
    2009-07h:  500
    #
    # Time constant for accelerating to the maximum speed during
    #     inertia auto-tuning
    # 20 to 800 ms; def. 125
    2009-08h:  125
    #
    # Waiting time after an individual inertia auto-tuning
    # 50 to 10000 ms; def. 800
    2009-09h:  800
    #
    # Number of motor revolutions per inertia auto-tuning
    # 0 to 10000 rev/100; def. 100
    2009-0Ah:  100
    #
    # Vibration threshold
    # 0 to 1000 %/10; def. 50
    2009-0Ch:  50
    #
    # Frequency of the 1st notch
    # 50 to 8000 Hz; def. 8000
    2009-0Dh:  8000
    #
    # Width level of the 1st notch
    # 0 to 20; def. 2
    2009-0Eh:  2
    #
    # Depth level of the 1st notch
    # 0 to 99; def 0
    2009-0Fh:  0
    #
    # Frequency of the 2nd notch
    # 50 to 8000 Hz; def. 8000
    2009-10h:  8000
    #
    # Width level of the 2nd notch
    # 0 to 20; def. 2
    2009-11h:  2
    #
    # Depth level of the 2nd notch
    # 0 to 99; def 0
    2009-12h:  0
    #
    # Frequency of the 3rd notch
    # 50 to 8000 Hz; def. 8000
    2009-13h:  8000
    #
    # Width level of the 3rd notch
    # 0 to 20; def. 2
    2009-14h:  2
    #
    # Depth level of the 3rd notch
    # 0 to 99; def 0
    2009-15h:  0
    #
    # Frequency of the 4th notch
    # 50 to 8000 Hz; def. 8000
    2009-16h:  8000
    #
    # Width level of the 4th notch
    # 0 to 20; def. 2
    2009-17h:  2
    #
    # Depth level of the 4th notch
    # 0 to 99; def 0
    2009-18h:  0
    #
    # Subidxs 19 read-only

    # *** 200Ah Fault and Protection Parameters ***
    #
    # Power input phase loss protection
    # 1:  Enable faults and warnings
    # - Enable voltage fluctuation alarm faults and warnings
    200A-01h:  1
    #
    # Absolute position limit
    # 0 to 2; def. 0
    200A-02h:  0
    #
    # Motor overload protection gain
    # 50 to 300 %; def. 100
    200A-05h:  100
    #
    # Overspeed threshold
    # 0 to 20000 RPM; def. 100
    200A-09h:  0
    #
    # Threshold of excessive local position following deviation
    # 0 to 2^32 - 1; def. 25185824
    200A-0Bh:  2000000
    #
    # Runaway detection
    # 0 to 1; def. 1
    200A-0Dh:  0
    #
    # Power module over-temperature threshold
    # 120 to 175 °C; def. 135
    200A-13h:  150
    #
    # Filter time constant of touch probe 1
    # 0 to 630 us/100; def. 200
    200A-14h: 200
    #
    # Filter time constant of touch probe 2
    # 0 to 630 us/100; def. 200
    200A-15h:  200
    #
    # STO function display
    # 0 to 1; def. 0
    200A-16h:  0
    #
    # Filter time constant of speed feedback display value
    # 0 to 5000 ms; def. 50
    200A-1Ah: 50
    #
    # Motor overload warning/fault selection
    # 0 to 1; def. 0
    200A-1Bh:  0
    #
    # Speed DO filter time constant
    # 0 to 5000 ms; def. 50
    200A-1Ch:  50
    #
    # Motor stall over-temperature protection time window
    # 10 to 65535 ms; def. 200
    200A-21h:  200
    #
    # Motor stall over-temperature protection
    # 0 to 1; def. 1
    200A-22h:  1
    #
    # Absolute encoder multi-turn overflow fault selection
    # 0 to 1; def. 1
    200A-25h:  0
    #
    # Overtravel compensation selection
    # 0 to 1; def. 0
    200A-29h:  0
    #
    # Regenerative resistor over-temperature threshold
    # 100 to 175 °C; def. 115
    200A-32h:  115
    #
    # Encoder communication fault tolerance threshold
    # 0 to 31; def. 3
    200A-33h:  3
    #
    # Phase loss detection filter times
    # 3 to 36; def. 20
    200A-34h:  20
    #
    # Encoder temperature protection threshold
    # 0 to 175; def. 0
    200A-35h:  0
    #
    # Runaway current threshold
    # 1000 to 4000 %/10; def. 2000
    200A-38h:  2000
    #
    # Reset delay
    # 0 to 60000 ms; def. 10000
    200A-39h: 10000
    #
    # Runaway speed threshold
    # 1 to 1000 RPM; def. 50
    200A-3Ah: 50
    #
    # Runaway speed filter time
    # 1 to 1000 ms/10; def. 20
    200A-3Bh:  20
    #
    # Runaway protection detection time
    # 10 to 1000 ms; def. 30
    200A-3Ch:  30
    #
    # Overspeed threshold
    # 0 to 20000; def. 0
    200A-47h:  0
    #
    # Maximum time of ramp-to-stop
    # 0 to 65535 ms; def. 10000
    200A-49h:  10000
    #
    # STO disconnection filter time
    # 0 to 5 ms; def. 5
    200A-4Ah:  5
    #
    # STO fault tolerance filter time
    # 0 to 10 ms; def. 10
    200A-4Bh:  10
    #
    # STO servo off filter time
    # 0 to 25 ms; def. 20
    200A-4Ch:  20

    # *** Group 200Bh:  Monitoring Parameters ***
    #
    # All params RO except subidx 22, used to select log to display

    # *** 200Dh Auxiliary function parameters ***
    #
    # Software reset
    # Set to 1 to soft-reboot drive
    # 200D-01h:  0
    #
    # Fault reset
    # Set to 1 to clear faults outside operational state
    # 200D-02h:  0
    #
    # Offline inertia autotuning selection
    # 0 to 1; def. 0
    200D-03h:  0
    #
    # Emergency stop
    # Set to 1 to command e-stop
    200D-06h:  0
    #
    # Forced DI/DO selection switch
    # - 0: No operation
    # - 1: Forced DI enabled, forced DO disabled
    # - 2: Forced DI disabled, forced DO enabled
    # - 3: Forced DI and DO enabled
    # - 4: EtherCAT forced DO enabled
    # Also see 2004h
    200D-12h:  4
    #
    # Forced DI setting
    #
    # Defines whether the DI functions set in group 2003h is active
    # when forced DI is activated (200D-12h = 1 or 3).
    #
    # 0 to 0x1F; default 0x1F
    # Bits 0-5:  DI1-DI5
    200D-13h:  0x001F
    #
    # Forced DO setting:
    # 0 to 7; def. 0
    # - Bits 0-2 correspond to DO1-DO3, respectively
    # - Makes no difference with SV660N (03029065) v903.4 v902.9 fw
    # Also see 2004h
    200D-14h:  0
    #
    # Absolute encoder reset selection
    # 0 to 2; def. 0
    # 0:  No operation
    # 1:  Reset encoder fault
    # 2:  Reset encoder fault and multi-turn data
    #200D-15h:  0

    # *** 200Eh Auxiliary function parameters ***
    #
    # Node address
    # - For serial communication
    # - Used in Inovance software for e.g. firmware update
    # - May be configured on keypad
    200E-01h:  1
    #
    # Update parameter values written through communication to EEPROM
    # 0 to 3; def. 3
    # - 0:  All setting not saved/volatile
    # - 3:  Save everything to EEPROM/non-volatile
    200E-02h:  0
    #
    # EtherCAT slave name
    # 0 to 65535; no default (set by master)
    # 200E-15h:  null
    #
    # EtherCAT slave alias
    # 0 to 65535; def. 0  (0=master sets address)
    200E-16h:  0
    #
    # Number of SYNC interrupts allowed by EtherCAT
    # 1 to 20; def. 8
    200E-17h:  8
    #
    # SYNC loss counter
    # 0 to 65535; def. 0
    # - This is a log counter
    # 200E-19h:  0
    #
    # SYNC mode setting
    # 0 to 2; def. 1
    # 0:  Reserved
    # 1, 2:  Synchronization 1, 2, respectively
    200E-20h:  1
    #
    # EtherCAT synchronization error threshold
    # - Unit uS; range 100-4000; default 3000
    200E-21h:  3000
    #
    # Subidxs 03, 1A-1E, 22-26 read-only
    # Subidx 0C not described in manual

    # *** Group 203Fh:  Manufacturer Fault Codes ***
    #
    # 203Fh is RO

    # *** Group 6000h:  Standard Device Profile Parameters ***
    #
    # Quick stop option code
    # 0 to 7; def. 2
    # CSP mode:
    # 3:  Stop at emergency stop torque in 2007-10h; brake & power off
    605Ah: 3
    #
    # Stop mode at S-OFF
    # -4 to 1; default 0
    # 0:  Coast to stop, keeping de-energized status
    605Ch:  0
    #
    # Halt stop option code
    # 1 to 3; def. 1
    # 1:  Ramp to stop as defined by 6084h/609Ah (HM), keeping position lock status
    605Dh:  1
    #
    # Stop mode at No. 2 fault
    # -5 to 3; default 2
    # 2:  Ramp to stop as defined by 6085h, keeping de-energized status
    605Eh:  2
    #
    # Modes of operation
    # 1:  PP
    # 6:  HM
    # 8:  CSP
    # 9:  CSV
    # 10:  CST
    6060h:  8
    #
    # Following error window
    # 0 to (2^32 - 1) ref. units; def. 3145728 (20-bit enc.) or
    #     25165824 (23-bit enc.)
    6065h: 2000000
    #
    # Following error time out
    # 0 to 65535 ms; def. 0
    6066h:  0
    #
    # Position window
    # 0 to (2^32 - 1); def. 734
    6067h:  5872
    #
    # Position window time:  0-65535 (ms)
    # - FIXME - better servo tuning should help us narrow this window
    6068h: 65535
    #
    # Velocity window
    # 0 to 65535 RPM; def. 10
    606Dh:  10
    #
    # Velocity window time
    # 0 to 65535 ms; def. 0
    606Eh:  0
    #
    # Velocity threshold
    # 0 to 65535 RPM; def. 10
    606Fh:  10
    #
    # Velocity threshold time
    # 0 to 65535 ms; def. 0
    6070h:  0
    #
    # Max. torque
    # 0 to 3000 %/10; default 3000
    6072h:  3000
    #
    # Home offset:
    # -2^31 to +(2^31 - 1) ref. units; def. 0
    607Ch: 0
    #
    # Minimum position limit
    # -2^31 to +(2^31 - 1) ref. units; def. -2^31
    607D-01h:  -2147483648
    #
    # Maximum position limit
    # -2^31 to +(2^31 - 1) ref. units; def. 2^31 - 1
    607D-02h:  2147483647
    #
    # Polarity
    # 0 to 255; def. 0
    # bits 5, 6, 7 negate torque, speed, position reference polarities
    607Eh:  0
    #
    # Maximum profile velocity
    # 0 to (2^32 - 1) ref. units/s; def. 104857600
    607Fh:  104857600
    #
    # Profile velocity
    # 0 to (2^32-1) ref. units/s; def. 174762
    # 6081h: 174762
    #
    # Profile acceleration
    # 0 to (2^32-1) ref. units/s/s; def. 174762666
    # 6083h: 174762666
    #
    # Profile deceleration
    # 0 to (2^32-1) ref. units/s/s; def. 174762666
    6084h: 174762666
    #
    # Quick stop deceleration
    # 0 to (2^32 - 1) ref. units/s/s; def. 2147483647
    6085h:  2147483647
    #
    # Torque slope
    # 0 to (2^32 - 1) %/10/s; def. 4294967295
    6087h:  4294967295
    #
    # Gear Ratio
    # Divide encoder counts by 1
    # - Motor revolutions, 1 to (2^32-1), def. 1
    #   Defines the resolution of the motor.
    6091-01h: 1
    # - Shaft revolutions, 1 to (2^32-1), def. 1
    #   Defines the resolution of the load shaft.
    6091-02h: 1
    #
    # Homing method
    # 35:  Home on current position
    6098h:  35
    #
    # Homing speeds
    #
    # Speed during search for switch
    # - Speed during search for switch
    # - 0 to 2^32-1; default 1747627 ref. units/sec; def. 1398101
    # 6099-01h:  1398101
    # - Speed during search for zero
    # - 10 to (2^32 - 1) ref. units/s; def. 100
    # 6099-02h:  100
    #
    # Homing acceleration
    # 0 to (2^32 - 1) ref. units/s/s; def. 100
    # 609Ah:  100
    #
    # Position offset
    # -2^31 to +(2^31 - 1) ref. units; def. 0
    60B0h:  0
    #
    # Velocity offset
    # -2 31 to +(2 31 - 1) ref. units; def. 0
    60B1h:  0
    #
    # Torque offset
    # -3000 to +3000 %/10; def. 0
    60B2h:  0
    #
    # Touch probe function
    # 0 to 65535; def. 0
    # (each bit has meaning; 0 switches everything off)
    60B8h:  0
    #
    # Positive torque limit value
    # 0-3000 x 0.1%; default 3000
    #
    # Defines the maximum torque limit of the servo drive in the
    # forward direction.
    60E0h:  3000
    #
    # Negative torque limit value
    # 0-3000 x 0.1%; default 3000
    #
    # Defines the maximum torque limit of the servo drive in the
    # reverse direction.
    60E1h:  3000
    #
    # Digital output
    # Indicates the current DO logic of the servo drive.
    #
    # - Bit mask
    #   Defines whether to enable the forced DO function.
    #   Bits 16-18:  DO1-DO3
    #   Bit 26:      P/PI Gain switchover enabled
    #
    #
    # Actual position calculation method
    # 0 to 1; def. 0
    # 0:  Absolute homing; 6064h (Position actual value) set to 607Ch
    #     (Home offset)
    # 1:  Relative homing;  6064h (Position actual value) set to 607Ch
    #     (Home offset) + current encoder feedback
    60E6h:  0
    #
    # Physical output
    # 0 to FFFFFFFF; def. 0
    # bits 16-18 correspond to DO1-DO3:
    #   Forced output (0: OFF; 1: ON), only when H0D-17 is set to 4
    #   and corresponding bit of 60FE-02 is set to 1
    # (PDO)
    # 60FE-01h:  0x00000000
    #
    # Digital output:  Bit mask
    # - Bits 16, 17, 18 correspond to DO1, DO2, DO3, respectively
    # - When high, output may be forced high via 60FE-01h bits 16-18
    # - Also see 2004h, 200D-12h, 200D-14h
    60FE-02h:  0x00070000
    #
    # Idxs 6040h, 6041h, 6071h, 607Ah, 6081-6084h, 60FE-01h, 60FFh are
    #     PDOs or N/A
    #
    # Idxs 603Fh, 6061-6064h, 606Ch, 6074h, 6077h, 60B9-60BDh, 60E3h,
    #     60F4-60FDh, 6502h read-only


# Inovance IS620N
-
  vendor_id:  0x00100000
  product_code:  0x000C0108
  revision_no:  0x00010001

  addresses:
    - [0, 0]
    - [0, 1]
    - [0, 2]
    - [0, 3]
    - [0, 4]
    - [0, 5]

  # Distributed clock
  dc_conf:
    sync0Shift: 350000

  # Sync manager configuration
  sync_manager:
    '0':
      # Mailboxes out
      dir: out
    '1':
      # Mailboxes in
      dir: in
    '2':
      # RPDOs:  Receive PDOs ("out" to drive)
      dir: out
      pdo_mapping:
        index: 1600h
        entries:
          - index: 6040h
            name: control_word
          # Convert joint cmd reference values to drive values
          # All joints:
          # - encoder resolution: 2**23 (23bit)
          # - belt ratio = 1 / 1 (unless otherwise specified)
          # - pos/vel cmd scale = (encoder resolution) * (gearbox ratio)
          #   * (belt ratio) / (2pi)
          # - torque cmd scale = 1000.0 / ((gearbox ratio) * (nominal torque))
          #
          # Joint 1:
          # - gearbox ratio: 101 (actually 100, but inverted!)
          # - belt ratio:  36 / 24
          # - nominal torque: 2.39 Nm
          # - pos/vel cmd scale:  202265896.97232303
          # - torque cmd scale:  2.7617824543960667
          #
          # Joint 2:
          # - gearbox ratio: 100
          # - nominal torque: 2.39 Nm
          # - pos/vel cmd scale:  133508842.88602179
          # - torque cmd scale:  4.1841004184100417
          #
          # Joint 3:
          # - gearbox ratio: 80
          # - nominal torque: 1.27 Nm
          # - pos/vel cmd scale:  106807074.30881745
          # - torque cmd scale:  9.8425196850393704
          #
          # Joint 4:
          # - gearbox ratio: 81 (actually 80, but inverted!)
          # - belt ratio:  36 / 28
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  139039923.51987126
          # - torque cmd scale:  30.006858710562415
          #
          # Joint 5:
          # - gearbox ratio: 81
          # - belt ratio:  30 / 30
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  108142162.73767766
          # - torque cmd scale:  38.580246913580247
          #
          # Joint 6:
          # - gearbox ratio: -50  (reverse direction)
          # - nominal torque: 0.32 Nm
          # - pos/vel cmd scale:  -66754421.443010896
          # - torque cmd scale:  -62.5

          - index: 607Ah
            name: position_reference
            scale:
              - 202265896.97232303
              - 133508842.88602179
              - 106807074.30881745
              - 139039923.51987126
              - 108142162.73767766
              - -66754421.443010896
          - index: 60B1h
            name: velocity_reference
            scale:
              - 202265896.97232303
              - 133508842.88602179
              - 106807074.30881745
              - 139039923.51987126
              - 108142162.73767766
              - -66754421.443010896
          - index: 60B2h
            name: torque_reference
            scale:
              - 2.7617824543960667
              - 4.1841004184100417
              - 9.8425196850393704
              - 30.006858710562415
              - 38.580246913580247
              - -62.5
          - index: 6060h
            name: control_mode
    '3':
      # TPDOs:  Transmit PDOs ("in" from drive)
      dir: in
      pdo_mapping:
        index: 1A00h
        entries:
          - index: 6041h
            name: status_word
          - index: 6061h
            name:  control_mode_fb
          # Convert joint drive feedback values to ROS (inverse direction)
          # - pos/vel fb scale = 1.0 / (pos/vel cmd scale)
          # - torque fb scale = 1. / (torque cmd scale)
          #
          # Joint 1:
          # - pos/vel fb scale:  4.9439871721768036e-09
          # - torque fb scale:  0.36208500000000005
          #
          # Joint 2:
          # - pos/vel fb scale:  7.4901405658478579e-09
          # - torque fb scale:  0.23899999999999999
          #
          # Joint 3:
          # - pos/vel fb scale:  9.3626757073098216e-09
          # - torque fb scale:  0.1016
          #
          # Joint 4:
          # - pos/vel fb scale:  7.1921788698127573e-09
          # - torque fb scale:  0.033325714285714285
          #
          # Joint 5:
          # - pos/vel fb scale:  9.2470871183306876e-09
          # - torque fb scale:  0.025920000000000002
          #
          # Joint 6:
          # - pos/vel fb scale:  -1.4980281131695716e-08
          # - torque fb scale:  -0.016

          - index: 6064h
            name:  position_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 606Ch
            name:  velocity_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 6077h
            name:  torque_actual_value
            scale:
              - 0.36208500000000005
              - 0.23899999999999999
              - 0.1016
              - 0.033325714285714285
              - 0.025920000000000002
              - -0.016
          - index: 60F4h
            name:  following_error_actual_value
            scale:
              - 4.9439871721768036e-09
              - 7.4901405658478579e-09
              - 9.3626757073098216e-09
              - 7.1921788698127573e-09
              - 9.2470871183306876e-09
              - -1.4980281131695716e-08
          - index: 203Fh
            name: error_code

  # Parameter settings
  param_values:
    # *** Servo Motor Parameters ***
    #
    # Motor SN:
    # 14101:  Inovance 23-bit absolute encoder
    2000-01h: 14101

    # *** Servo Drive Parameters ***
    #
    # Servo drive SN:
    # 2:  S1R6 0.2kW
    # 3:  S2R8 0.4kW
    # 5:  S5R5 0.75kW
    2001-03h: [5, 5, 3, 2, 2, 2]

    # *** Basic control ***
    #
    # Absolute system selection:  def. 0
    # 1:  Absolute position linear mode (encoder retains value on power down)
    2002-02h: 1

    # *** Output terminal Parameters ***
    #
    # DO1 function selection:
    # 9:  BK (Brake output)
    # - Maybe only Rob's machine?
    2004-01h: 9
    #
    # DO2 function selection:
    # 9:  BK (Brake output)
    2004-03h: 9

    # *** Position Control Parameters ***
    #
    # Speed feedforward control selection
    # 2: Use 60B1h as source of speed feedforward signal in CSP mode
    2005-14h: 2

    # *** Speed Control Parameters ***
    #
    # Torque feedforward control selection
    # 2: Use 60B2h as source of torque feedforward signal in CSP mode
    2006-0Ch: 2

    # *** Torque Control Parameters ***
    #
    # Time constant of torque filter
    2007-06h: 100
    #
    # Time constant of torque feedforward filter
    2007-07h: 100
    #
    # External positive torque limit:  def. 3000
    # (Restore default after an earlier mistake in this file)
    2007-0Ch:  3000

    # *** Gain Parameters ***
    # NB: parameter values are all integers in drives but are decimals
    # in manual.  Example: speed loop gain of 800 is equal to 80.0 Hz
    # in the manual.
    #
    # Velocity proportional gain *0.1Hz
    2008-01h: [350, 400, 400, 250, 250, 400]
    #
    # Velocity time constant *0.01ms
    2008-02h: [1000, 1000, 1000, 1000, 1000, 1000]
    #
    # Position proportional gain *0.1Hz
    2008-03h: [550, 550, 550, 400, 400, 550]
    #
    # Gain switchover
    # use 2008-0Ah
    2008-09h: 1
    #
    # Gain switchover condition
    # 0:  Always use first gain
    # - No difference between gains in motion and gains when positioning
    2008-0Ah: 0
    #
    # Inertia ratio
    # values from qc.py *0.01
    2008-10h: [45, 318, 216, 281, 141, 38]
    #
    # Velocity feedforward filter * 0.01ms
    2008-13h: 100
    #
    # Speed feedforward gain:  0-1000 (0.1%) def. 0
    # - Feedforward gain set to minimize following error - max value
    #   produces best results
    2008-14h: 1000
    #
    # Torque feedforward filter * 0.01ms
    2008-15h: 100
    #
    # Torque feedforward gain 0-2000 (0.1%) def. 0
    2008-16h: 1000
    #
    # Velocity feedback cutoff frequency
    2008-18h: 4000
    #
    # PID structure
    2008-19h: 1000

    # *** Auto-adjusting Parameters ***
    #
    # Automatic gain tuning mode selection
    # 0: disabled
    # 1:  Automatic gain tuning mode, gain parameters tuned automatically
    #     based on stiffness table
    # - Use automatic gain tuning so we don't have to worry about
    #   individual gain settings for now
    2009-01h: 0
    #
    # Stiffness level selection 0-31;
    # higher -> stronger gain and quicker response
    # 2009-02h: 8
    2009-02h: [14, 15, 15, 12, 12, 15]
    #
    # Disable inertia ratio autotune
    2009-04h: 0

    # *** Error and Protection Parameter ***
    #
    # Power input phase loss protection
    # 1:  Enable faults and warnings
    # - Enable voltage fluctuation alarm faults and warnings
    200A-01h: 1
    #
    # Runaway detection
    200A-0Dh: 0

    # *** Communication ***
    #
    # Synchronization error threshold:  0-2000 (ns); def. 500
    # - Manual says 2000 max, but we found 3000 default on some drives!
    200C-2Dh: 3000
    #
    # Position control buffer:  0 disabled; 1 enabled
    200C-2Eh: 0

    # *** Standard Device Profile Parameters ***
    # Quick stop option code
    # CSP mode:
    # 3:  Stop at emergency stop torque in 2007-10h; brake & power off
    605A-00h: 3
    #
    # Following error window
    6065-00h: 2000000
    #
    # Position window:  (reference units) def. 734
    # - goal position threshold
    6067-00h: 5872
    #
    # Position window time:  0-65535 (ms)
    # - FIXME - better servo tuning should help us narrow this window
    6068-00h: 65535
    #
    # Home offset:  (ref. units) def. 0
    # - Early ZA6 robots were homed with J3 at -90 deg., and some
    #   robots out in the field will still have 0xf6000001 in this
    #   param.  This is instead set in the drive manager during
    #   homing.
    # 607C-00h: [0, 0, 0, 0, 0, 0]
    #
    # 6091h Gear Ratio
    # Sichen sets gear ratio to 6000, but we set it to 1 and handle it in HAL
    # Motor revolutions
    6091-01h: 1
    # Shaft revolutions
    6091-02h: 1
    #
    # Homing method
    # 35:  Home on current position
    6098-00h: 35


# iTegva E7.820.001 16-ch Dig.In/16-ch Relay Out(Access_Byte)
-
  vendor_id:  0x00000A09
  product_code:  0x00000201
  revision_no:  100

  addresses:
    - [0, 6]

  # Sync manager configuration
  sync_manager:
    '0':
      dir: out
      pdo_mapping:
        index:  1600h
        entries:
          - index:  7001-01h
            bits:
              - dout-0
              - dout-1
              - dout-2
              - dout-3
              - dout-4
              - dout-5
              - dout-6
              - dout-7
    '1':
      dir: out
      pdo_mapping:
        index:  1601h
        entries:
          - index:  7001-02h
            bits:
              - dout-8
              - dout-9
              - dout-10
              - dout-11
              - dout-12
              - dout-13
              - dout-14
              - dout-15
    '2':
      # TPDOs:  Transmit PDOs ("in" from drive)
      dir: in
      pdo_mapping:
        index: 1A00h
        entries:
          - index: 6001-01h
            bits:
              - din-0
              - din-1
              - din-2
              - din-3
              - din-4
              - din-5
              - din-6
              - din-7
          - index: 6001-02h
            bits:
              - din-8
              - din-9
              - din-10
              - din-11
              - din-12
              - din-13
              - din-14
              - din-15

# Sim EtherCAT Drive
-
  vendor_id:  0xB090C0
  product_code:  0xB0905030
  revision_no:  0x00000001

  addresses:
    - [0, 0]
    - [0, 1]
    - [0, 2]
    - [0, 3]
    - [0, 4]
    - [0, 5]

  # These sim devices aren't realistic enough to have working PDOs,
  # and SDOs can be set & read but don't actually do anything
